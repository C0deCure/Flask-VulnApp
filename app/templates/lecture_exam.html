<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>시험 정보 - {{ lec.name }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style1.css') }}">
  <style>

    .container{max-width:1000px;margin:24px auto;padding:0 16px}
    .card{border:1px solid #eee;border-radius:10px;padding:14px}
    .btn{display:inline-block;border:1px solid #d6d6d6;padding:8px 12px;border-radius:8px;text-decoration:none;color:#333}
    .btn.red{border:0;background:#c62917;color:#fff}
    .danger{color:#c62917;font-weight:700}
    .blur{filter:blur(6px);user-select:none}
    .grid{display:grid;grid-template-columns:110px 1fr;gap:10px 16px;line-height:1.7}
    .label{font-weight:700}
  </style>
</head>
<body>
  {% include 'partials/_topbar.html' %}

  <div class="container">
    <h2 style="margin:0 0 4px 0">{{ lec.name }}</h2>
    <div style="color:#777;font-size:12px;margin-bottom:12px;">{{ lec.professor }} · {{ lec.campus or '-' }}</div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <h3 style="margin:0;">시험 정보</h3>
      <div>
        <a href="{{ url_for('lecture.exam_info_write', lecture_id=lec.lecture_id) }}" class="btn" style="margin-right:6px;">등록하기</a>
        <a href="{{ url_for('lecture.lecture_reviews', lecture_id=lec.lecture_id) }}" class="btn">강의평으로</a>
      </div>
    </div>

    {% if exams and exams|length %}
      <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:12px;">
        {% for ex in exams %}
          <li class="card">
            <div style="font-weight:700;font-size:18px;margin-bottom:8px;">{{ ex.title }}</div>

            {% if ex.unlocked %}
              <div class="grid">
                <div class="label">시험 전략</div>
                <div style="white-space:pre-wrap">{{ ex.strategy or '-' }}</div>

                <div class="label">문제 유형</div>
                <div>{{ ex.types or '-' }}</div>

                <div class="label">문제 예시</div>
                <div>
                  {% if ex.samples and ex.samples|length %}
                    <ul style="list-style:disc;padding-left:18px;margin:0;">
                      {% for s in ex.samples %}
                        <li style="margin:2px 0">{{ s }}</li>
                      {% endfor %}
                    </ul>
                  {% else %}-{% endif %}
                </div>
              </div>
            

            {% else %}
              <p style="margin:4px 0 10px 0;">
                이 정보를 열람하기 위해 <span class="danger">5 포인트</span>가 차감됩니다.
                한 번 열람한 후에는 영구적으로 볼 수 있습니다.
              </p>

          
              <form action="{{ url_for('lecture.exam_info_view', exam_id=ex.exam_id) }}" method="post" class="view-form">
             
                <input type="hidden" name="point" value="0">
                <button type="button" class="btn red view-btn">열람하기</button>
              </form>

         
              <div class="blur" style="white-space:pre-wrap;line-height:1.6;">
                {% if ex.strategy %}[시험 전략]\n{{ ex.strategy }}\n\n{% endif %}
                {% if ex.types %}[문제 유형]\n{{ ex.types }}\n\n{% endif %}
                {% if ex.samples and ex.samples|length %}[문제 예시]\n{{ ex.samples[0] }}{% if ex.samples|length>1 %}\n...{% endif %}{% endif %}
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p style="color:#777;font-size:12px;">등록된 시험 정보가 없습니다.</p>
    {% endif %}
  </div>

  <script>

  const MY_POINT = {{ my_point or 0 }};
  const PRICE = 5;


  document.querySelectorAll('.view-form').forEach(form => {
    const btn = form.querySelector('.view-btn');


    btn.addEventListener('click', async () => {
      const body = new URLSearchParams();
      body.set('point', MY_POINT);

      try {
        await fetch(form.action, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
            'X-Requested-With': 'XMLHttpRequest'
          },
          body: body.toString()
        });

        if (MY_POINT < PRICE) {
          alert('포인트가 부족합니다.\n먼저 강의평이나 시험 정보를 공유해주세요 :D');
        }
        else {
          alert('시험 정보를 열람했습니다! (포인트 -5)');
        }
      } catch (error) {
        console.error("요청 실패:", error);
        alert("요청을 보내는 중 오류가 발생했습니다.");
      }
    });
  });
</script>


</body>
</html>
