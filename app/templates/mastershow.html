{% extends "articleLayout.html" %}

{% block content %}
<div id="main">
    <div id="board">
        <div id="title" class="article">
            <h1>
                <a href="/board/{{ board.url }}">{{ board.name }}</a>
            </h1>
        </div>
        <div id="text" class="article">
            <img class="profileimg" src="{{ url_for('static', filename='images/0.png') }}">
            <div class="profile">
                <h3 class="large">{{ post.id }}</h3>
                <time class="large">ë¹„ê³µê°œ</time>
                {% if current_user.is_authenticated and current_user.id == post.user_id %}
                    <a href="/board/{{ board.url }}/delete/{{ post.id }}">
                        <p class="delete">ì‚­ì œ</p>
                    </a>
                    <a href="/board/{{ board.url }}/edit/{{ post.id }}">
                        <p class="edit">ìˆ˜ì •</p>
                    </a>
                {% endif %}
                <h2 class="large">{{ post.title }}</h2>
                <p id="post-text" class="large"></p>
            </div>
        </div>
        <div id="comment" data-post-id="{{ post.id }}" data-current-user-id="{{ current_user.id if current_user.is_authenticated else '' }}">
            <form id="replyForm" action="/board/{{ board.url }}/{{ post.id }}/comment" method="post" class="writecomment">
                <input type="text" id="commentInput" name="text" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" class="commentblank">
                <input type="hidden" name="parent_id" value="{{ parent_comment.id if parent_comment else '' }}">
                <input type="submit" id="submit-btn" class="submit">
            </form>
        </div>
    </div>
</div>
<!-- modal begin -->
<div id="edit-modal-overlay" class="modal-overlay hidden">
    <div class="modal-content">
        <button id="modal-close-btn" class="close-button">&times;</button>

        <h2>ëŒ“ê¸€ ìˆ˜ì • ğŸ“</h2>
        <form id="edit-form">
            <input type="hidden" id="edit-comment-id">

            <div class="form-group">
                <label for="edit-new-content">ìˆ˜ì •í•  ë‚´ìš©</label>
                <textarea id="edit-new-content" rows="5" required></textarea>
            </div>
            <button type="submit">ìˆ˜ì • ì™„ë£Œ</button>
        </form>
        <p id="modal-result-message"></p>
    </div>
</div>
<!-- modal end -->
{% endblock %}
{% block script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.2.3/purify.min.js"></script>
<script type='text/javascript'>
    const textContent = "{{ post.text | safe }}";
    document.getElementById("post-text").innerHTML = DOMPurify.sanitize(textContent);
</script>
<script type='text/javascript'>
    // ===== ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° =====
    const modalOverlay = document.getElementById('edit-modal-overlay');
    const editForm = document.getElementById('edit-form');
    const hiddenCommentIdInput = document.getElementById('edit-comment-id');
    const newContentInput = document.getElementById('edit-new-content');
    const modalResultMessage = document.getElementById('modal-result-message');
    const closeModalBtn = document.getElementById('modal-close-btn');

    // --- ëª¨ë‹¬ì„ ë‹«ëŠ” í•¨ìˆ˜ ---
    function hideEditModal() {
        modalOverlay.classList.add('hidden');
        modalResultMessage.textContent = ''; // ë©”ì‹œì§€ ì´ˆê¸°í™”
    }

    // --- ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    // 1. 'X' ë²„íŠ¼ í´ë¦­ ì‹œ
    closeModalBtn.addEventListener('click', hideEditModal);

    // 2. ëª¨ë‹¬ ë°”ê¹¥ì˜ ì–´ë‘ìš´ ì˜ì—­ í´ë¦­ ì‹œ
    modalOverlay.addEventListener('click', (event) => {
        if (event.target === modalOverlay) {
            hideEditModal();
        }
    });
</script>
<script src="{{ url_for('static', filename='js/comments.js') }}"></script>
{% endblock %}