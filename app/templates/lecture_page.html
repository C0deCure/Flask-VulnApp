<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>{{ lec.name }} - 강의평</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style1.css') }}">
  <style>
    /* 폰트 및 기본 설정 */
    body { font-family: "맑은 고딕", 돋움, tahoma, Arial, sans-serif; margin: 0; color: #222; font-size: 14px; }
    a { text-decoration: none; color: inherit; }
    
    /* 컨테이너 너비를 이미지에 맞춰 조정 */
    .container { max-width: 900px; margin: 24px auto; padding: 0 16px; } 
    
    /* 전체 레이아웃 (Side Menu + Main Content) */
    .flex-container { 
        display: flex; 
        gap: 20px; 
        align-items: flex-start; 
        margin-top: 15px;
    }
    
    /* ---------------------------------
    | 좌측 사이드바 (Sidebar) 스타일
    -----------------------------------*/
    .sidebar { 
      width: 220px; /* 제목이 한 줄에 표시되도록 너비 확장 */
      flex-shrink: 0; 
    }
    .lecture-header { margin-bottom: 20px; }
    /* 제목 스타일: 줄바꿈 없이 한 줄에 표시 */
    .lecture-title { 
        font-size: 22px; 
        font-weight: bold; 
        margin: 0; 
        display: block;
        white-space: nowrap; /* 제목이 잘리지 않도록 */
        overflow: hidden;
        text-overflow: ellipsis; 
    }
    .lecture-meta { color: #666; font-size: 13px; margin-top: 5px; display: block;}
    
    .sidebar-menu { 
      list-style: none; 
      padding: 0; 
      margin: 0; 
      border: 1px solid #e3e3e3; 
      border-radius: 4px; 
      background-color: #fff;
    }
    .sidebar-menu li a { 
      display: block; 
      padding: 8px 15px; 
      color: #292929; 
      font-size: 14px; 
      border-bottom: 1px solid #e3e3e3;
    }
    .sidebar-menu li:last-child a { border-bottom: none; }
    
    /* 활성 메뉴 스타일 (강의평) */
    .sidebar-menu li a.active { 
      color: #c62917; 
      font-weight: bold; 
      background-color: #f9f9f9; 
      border-left: 3px solid #c62917; 
      padding-left: 12px; 
    }
    /* 평가하기 버튼 스타일 */
    .sidebar-btn-group {
      margin-top: 10px;
      border: 1px solid #c62917;
      border-radius: 4px;
      padding: 5px 0;
      background-color: #fff;
    }
    .sidebar-btn { 
      display: block; 
      padding: 8px 15px; 
      color: #c62917; 
      font-weight: bold;
      text-align: left;
      font-size: 14px;
    }
    .sidebar-btn > span {
      display: inline-block;
      margin-right: 8px;
      line-height: 18px;
    }

    /* ---------------------------------
    | 메인 콘텐츠 (Main Content) 스타일
    -----------------------------------*/
    .main-content { 
        flex: 1; 
        margin-top: 15px;
        max-width: 630px; /* 빨간 네모 영역의 최대 너비를 제한하여 좁게 만듭니다. */
    }

    /* 평균 별점 영역 */
    .average-rating-section {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    .average-rating-number {
      font-size: 24px; 
      font-weight: bold;
      color: #4c4c4c;
      margin-right: 10px;
    }
    .average-rating-stars {
      font-size: 24px; 
      color: #fcc419; 
      margin-right: 0; 
    }

    /* 리뷰 목록 헤더 */
    .reviews-list-header {
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: bold;
      color: #292929;
    }

    /* 개별 리뷰 아이템 - 여백 압축 */
    .review-item {
      padding: 10px 0; 
      border-top: 1px solid #e3e3e3;
      display: flex;
      flex-direction: column; 
    }
    .review-item:first-child { border-top: none; padding-top: 0; }
    
    .review-info-group {
        display: flex;
        align-items: center;
        margin-bottom: 5px; 
    }
    
    .review-item .review-rating {
      color: #fcc419; 
      font-size: 14px; 
      margin-right: 10px; 
    }
    .review-item .meta-text {
      color: #a6a6a6;
      font-size: 12px;
      margin-right: 15px;
    }
    .review-item .review-content {
      white-space: pre-wrap;
      line-height: 1.4; 
      font-size: 14px;
      color: #292929;
      padding-left: 0; 
      margin-top: 3px;
    }
  </style>
</head>
<body>
  {% include 'partials/_topbar.html' %}

  <div class="container">
    
    <div class="flex-container">
      
      <aside class="sidebar">
        <div class="lecture-header">
          <h1 class="lecture-title">{{ lec.name }}</h1>
          <div class="lecture-meta">{{ lec.professor }} · {{ lec.campus or '-' }}</div>
        </div>
        
        <ul class="sidebar-menu">
          <li><a href="{{ url_for('lecture.lecture_reviews', lecture_id=lec.lecture_id) }}" class="active">강의평</a></li>
          <li><a href="{{ url_for('lecture.lecture_exam', lecture_id=lec.lecture_id) }}">시험 정보</a></li>
        </ul>
        
        <div class="sidebar-btn-group">
          <a href="{{ url_for('lecture.lecture_review_write', lecture_id=lec.lecture_id) }}" class="sidebar-btn">
            <span style="font-size:16px;">&#9999;</span> 평가하기
          </a>
        </div>
      </aside>

      <main class="main-content">
        
        {% if avg_rating is not none %}
        <div class="average-rating-section">
          <div class="average-rating-number">{{ avg_rating }}</div>
          <div class="average-rating-stars">
            {% set full_stars = avg_rating | round(0, 'floor') %}
            {% set empty_stars = 5 - full_stars %}
            {% for _ in range(full_stars | int) %}★{% endfor %}
            {% for _ in range(empty_stars | int) %}☆{% endfor %}
          </div>
        </div>
        {% endif %}

        <div class="reviews-list-header">강의평</div>

        {% if reviews %}
            {% for r in reviews %}
              <div class="review-item">
                <div class="review-info-group">
                    {% if r.rating %}
                    <div class="review-rating">
                        {% for _ in range(r.rating) %}★{% endfor %}{% for _ in range(5 - r.rating) %}☆{% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="review-meta">
                        <span class="meta-text">{{ r.semester }} 수강자</span>
                    </div>
                </div>
                
                <div class="review-content">{{ r.content|safe }}</div>
              </div>
            {% endfor %}
        {% else %}
            <p class="meta-text" style="padding: 15px 0;">아직 등록된 강의평이 없습니다.</p>
        {% endif %}
        
      </main>
    </div>
  </div>
</body>
</html>